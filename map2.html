<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Jacobs Карта Мечты</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <link rel="shortcut icon" href="img/favicon.png" type="image/png">
	<link rel="stylesheet" href="fonts/stylesheet.css">
	<link rel="stylesheet" href="libs/select2/select2.min.css">
	<link rel="stylesheet" href="libs/scrollbar/jquery.scrollbar.css">
	<link rel="stylesheet" href="css/styles.css">
	<link rel="stylesheet" href="collage/main.css">
	<!--[if lte IE 9]>
    <script src="http://phpbbex.com/oldies/oldies.js" charset="utf-8"></script>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

	<script src="https://cdnjs.cloudflare.com/ajax/libs/konva/7.2.5/konva.min.js"></script>
</head>

<body>
	<div class="wrapper">
		<div class="content">
			<header>
				<div class="menu">
					<a href="index.html" class="logo">
						<img src="img/logo.png" alt="">
					</a>
					<a href="#!" class="burger"></a>
					<nav class="menu-links">
						<a href="index.html" class="menu-link">Главная</a>
						<a href="index.html#prizes" class="menu-link">Призы</a>
						<a href="test.html" class="menu-link active">Карта мечты</a>
						<a href="winners.html" class="menu-link">Победители</a>
						<a href="product.html" class="menu-link">Продукт</a>
						<a href="#!" class="menu-link" target="_blank">Правила</a>
						<a href="faq.html" class="menu-link">FAQ</a>
						<a href="lk.html" class="menu-link login-link pop-op" data-popup="auth">Личный кабинет</a>
					</nav>
				</div>
			</header>
			<section class="collage-page">
				<div class="collage-title">Создай свою карту мечты</div>
				<div class="collage-text">Просто нажимай на стикеры, и они появятся на твоей Карте Мечты</div>
				<div class="collage collage2">
					<div class="collage-hidden">
						<img src="collage/img/trash.svg" class="collage-hidden__trash">
					</div>
					<div class="collage-inner">
						<div class="collage__items">
							<div class="collage__items-raw collage__items-raw1"></div>
							<div class="collage__items-raw collage__items-raw2"></div>
							<div class="collage__items-raw collage__items-raw3"></div>
							<div class="collage__items-raw collage__items-raw4"></div>
							<div class="collage__items-raw collage__items-raw5"></div>
						</div>
						<div class="cavnas-here collage__canvas-holder">
							<canvas></canvas>
						</div>
						<div class="collage__items">
							<div class="collage__items-raw collage__items-raw6"></div>
							<div class="collage__items-raw collage__items-raw7"></div>
							<div class="collage__items-raw collage__items-raw8"></div>
							<div class="collage__items-raw collage__items-raw9"></div>
						</div>
						<div class="collage__mobile-items collage-mobile-items">
							<div class="collage-mobile-items__desc">
								Просто нажимай на стикеры,<br>
								и они появятся на твоей Карте Мечты
							</div>
							<div class="collage-mobile-items__inner">

							</div>
							<button class="collage-mobile-items__close">закрыть</button>
						</div>
					</div>
				</div>
				<div class="collage-btns">
					<button id="clear" class="btn collage-btn btn-green">Очистить всё</button>
					<button id="screenshot" class="btn collage-btn">Опубликовать</button>
					<button id="curtain" class="btn add-elements-btn">Добавить элементы</button>
				</div>

				<script src="collage/lib/downscale.js"></script>
				<script src="collage/collage.js"></script>
				<script>
					const allImages = [
						{
							src: 'collage/img/ava-border.png',
							srcPin: 'collage/img/ava-pin.png',
							id: 20,
							type: 'avatar',
						},
						{
							src: 'collage/img/ava-border.png',
							srcPin: 'collage/img/ava-pin.png',
							id: 19,
							type: 'avatar',
						},
						{
							src: 'collage/img/default/1.png',
							id: 1,
						},
						{
							src: 'collage/img/2/2.png',
							id: 2,
						},
						{
							src: 'collage/img/default/3.png',
							id: 3,
						},
						{
							src: 'collage/img/default/4.png',
							id: 4,
						},
						{
							src: 'collage/img/default/5.png',
							id: 5,
						},
						{
							src: 'collage/img/2/6.png',
							id: 6,
						},
						{
							src: 'collage/img/2/7.png',
							id: 7,
						},
						{
							src: 'collage/img/default/8.png',
							id: 8,
						},
						{
							src: 'collage/img/default/9.png',
							id: 9,
						},
						{
							src: 'collage/img/default/10.png',
							id: 10,
						},
						{
							src: 'collage/img/2/11.png',
							id: 11,
						},
						{
							src: 'collage/img/2/12.png',
							id: 12,
						},
						{
							src: 'collage/img/2/13.png',
							id: 13,
						},
						{
							src: 'collage/img/2/14.png',
							id: 14,
						},
						{
							src: 'collage/img/2/15.png',
							id: 15,
						},
						{
							src: 'collage/img/2/16.png',
							id: 16,
						},
						{
							src: 'collage/img/2/17.png',
							id: 17,
						},
						{
							src: 'collage/img/2/18.png',
							id: 18,
						},
					]
					const imagesLeft1 = allImages.slice(0, 2);
					const imagesLeft2 = allImages.slice(2, 3);
					const imagesLeft3 = allImages.slice(3, 6);
					const imagesLeft4 = allImages.slice(6, 9);
					const imagesLeft5 = allImages.slice(9, 12);
					const imagesRight6 = allImages.slice(12, 14);
					const imagesRight7 = allImages.slice(14, 16);
					const imagesRight8 = allImages.slice(16, 17);
					const imagesRight9 = allImages.slice(17, 20);

					document.addEventListener('DOMContentLoaded', () => {
						if (window.innerWidth <= 1000) {
							let collageMobile = collage({
								images: allImages,
								isMobile: true,
								canvasWrapper: document.querySelector('.cavnas-here'),
								itemsContainers: [{
										element: document.querySelectorAll('.collage-mobile-items__inner')[0],
										images: allImages
									},
								],
								canvasBG: 'collage/img/bg2.jpg',
							});

							clear.addEventListener('click', function (e) {
								collageMobile.reset();
							})

							screenshot.addEventListener('click', function (e) {
								collageMobile.makeScreenshot((screenshotBase64) => {
									// place AJAX here to send on server screenshotBase64
									console.log(screenshotBase64);
								});
							})

							if(collageMobile.layer.find('.photo').length > 0){
								// photo exist on canvas
							}
							
							let curtainClass = document.querySelector('.collage-mobile-items').classList
							curtain.addEventListener('click', function (e) {
								curtainClass.add('active');
							})

							document.querySelector('.collage-mobile-items__inner').addEventListener('click', function(e){
								let curClassList = e.target.classList
								let curElem = e.target.closest('.collage-item');
								if(curElem){
									if(curElem.classList.contains('collage-avatar') && (!curElem.classList.contains('has-photo'))){
										return
									}
									curtainClass.remove('active');
								}
							})

							document.querySelector('.collage-mobile-items__close').addEventListener('click', function(e){
								curtainClass.remove('active');
							})
						} else {
							let collageDesktop = collage({
								images: allImages,
								canvasWrapper: document.querySelector('.cavnas-here'),
								itemsContainers: [{
										element: document.querySelector('.collage__items-raw1'),
										images: imagesLeft1
									},
									{
										element: document.querySelector('.collage__items-raw2'),
										images: imagesLeft2
									},
									{
										element: document.querySelector('.collage__items-raw3'),
										images: imagesLeft3
									},
									{
										element: document.querySelector('.collage__items-raw4'),
										images: imagesLeft4
									},
									{
										element: document.querySelector('.collage__items-raw5'),
										images: imagesLeft5
									},
									{
										element: document.querySelector('.collage__items-raw6'),
										images: imagesRight6
									},
									{
										element: document.querySelector('.collage__items-raw7'),
										images: imagesRight7
									},
									{
										element: document.querySelector('.collage__items-raw8'),
										images: imagesRight8
									},
									{
										element: document.querySelector('.collage__items-raw9'),
										images: imagesRight9
									},
								],
								canvasBG: 'collage/img/bg2.jpg',
							});

							clear.addEventListener('click', function (e) {
								collageDesktop.reset();
							})

							screenshot.addEventListener('click', function (e) {
								collageDesktop.makeScreenshot((screenshotBase64) => {
									// place AJAX here to send on server screenshotBase64
									console.log(screenshotBase64);
								});
							})

							
							if(collageDesktop.layer.find('.photo').length > 0){
								// photo exist on canvas
							}
						}


					});
				</script>
			</section>
		</div>
		<footer>
			<div class="container">
				<div class="footer-text">
					Сроки проведения акции: с 01.06.2021 по 31.08.2021 г. Все подробности об организаторе Акции, правилах проведения, количестве призов, сроках, месте и порядке их получения смотрите на dreams.jacobs.promo
				</div>
				<div class="footer-links">
					<a href="#!" target="_blank">Политика персональных данных</a>
					<a href="#!" target="_blank">Политика Куки файлов</a>
					<a href="#!" target="_blank">Использование вводных данных</a>
				</div>
				<div class="copyright">©2021 ООО «ЯКОБС ДАУ ЭГБЕРТС РУС». <br>Все права защищены.</div>
			</div>
		</footer>
	</div>
	<div class="popups">
		<div id="auth" class="popup">
			<div class="popup__wrap">
				<a href="#!" class="close-popup js-close-popup"></a>
                <div class="popup__inner">
                    <div class="popup__title">Вход</div>
                    <div class="popup__error"></div>
                    <form class="popup-form">
                    	<div class="input-field">
                    		<input type="text" name="phone" class="phone-mask" placeholder="Телефон" required>
                    	</div>
                    	<div class="input-field mb30">
                    		<input type="password" name="password" placeholder="Пароль" required>
                    	</div>
                    	<a href="#!" class="link restore-link pop-op" data-popup="restore-password">Я не помню свой пароль</a>
                    	<div class="btn-wrapper">
							<button class="btn">Войти</button>
						</div>
                    </form>
                    <div class="reg-text">
                    	Если вы впервые <br>на сайте, то вам необходимо
                    	<a href="#!" class="link popup-link pop-op" data-popup="reg">Зарегистрироваться</a>
                    </div>
                </div>
            </div>
		</div>
		<div id="reg" class="popup">
			<div class="popup__wrap">
				<a href="#!" class="close-popup js-close-popup"></a>
                <div class="popup__inner">
                    <div class="popup__title">Регистрация</div>
                    <div class="popup__error"></div>
                    <form class="popup-form">
                    	<div class="input-field">
                    		<label for="lastName">Фамилия</label>
                    		<input type="text" name="lastName" placeholder="Фамилия" required>
                    	</div>
                    	<div class="input-field">
                    		<label for="firstName">Имя</label>
                    		<input type="text" name="firstName" placeholder="Имя" required>
                    	</div>
                    	<div class="input-field">
                    		<label for="phone">Номер телефона</label>
                    		<input type="text" name="phone" class="phone-mask" placeholder="Номер телефона" required>                    		
                    	</div>
                    	<div class="checkbox-wrapper">
							<div class="input-field checkbox-field">
	                            <label for="check-rules" class="checkbox">
	                                <input id="check-rules" name="check-rules" type="checkbox" required>
	                                <span class="checkmark"></span>
	                                <span class="checkbox-text">Я согласен с <a href="#!" class="rules-link link" target="_blank">Правилами акции</a></span>
	                            </label> 
	                        </div>
	                        <div class="input-field checkbox-field">
	                            <label for="check-data" class="checkbox">
	                                <input id="check-data" name="check-data" type="checkbox" required>
	                                <span class="checkmark"></span>
	                                <span class="checkbox-text">Я согласен на обработку моих <a href="#!" class="rules-link link" target="_blank">персональных данных</a></span>
	                            </label> 
	                        </div>
						</div>
						<div class="btn-wrapper">
							<a href="#!" class="btn pop-op" data-popup="reg-success">Зарегистрироваться</a>
							<!-- <button class="btn">Зарегистрироваться</button> -->
						</div>
                    </form>
                </div>
            </div>
		</div>
		<div id="reg-success" class="popup">
			<div class="popup__wrap">
				<a href="#!" class="close-popup js-close-popup"></a>
                <div class="popup__inner">
                	<div class="popup__title">Регистрация пройдена</div>
                    <div class="popup__desc">Пароль отправлен в СМС <br>на номер телефона, указанный при регистрации</div>
                    <div class="btn-wrapper">
						<a href="#!" class="btn pop-op" data-popup="auth">Войти</a>
					</div>
                </div>
            </div>
		</div>
		<div id="restore-password" class="popup">
			<div class="popup__wrap">
				<a href="#!" class="close-popup js-close-popup"></a>
                <div class="popup__inner">
                    <div class="popup__title">Восстановление <br>пароля</div>
                    <form class="popup-form">
                    	<div class="popup__desc before-send">Введите номер телефона, указанный <br>при регистрации. Мы вышлем туда <br>новый пароль.</div>
                    	<div class="popup__desc after-send" style="display: none;">Пароль был отправлен в сообщении</div>
                    	<div class="input-field">
                    		<input type="text" name="phone" class="phone-mask" placeholder="Телефон" required>
                    	</div>
                    	<div class="input-field mb30">
							<span class="clock-text" style="display: none;">Можно отправить повторно через <span class="clock"></span></span>
                    	</div>
                    	<div class="btn-wrapper">
							<button class="btn">Получить пароль</button>
						</div>
                    </form>
                </div>
            </div>
		</div>
		<div id="feedback-success" class="popup">
			<div class="popup__wrap">
				<a href="#!" class="close-popup js-close-popup"></a>
                <div class="popup__inner">
                	<div class="popup__title">Ваше обращение <br>принято</div>
                    <div class="popup__desc">Ожидайте ответа на указанную <br>электронную почту. Спасибо!</div>
                    <div class="btn-wrapper">
						<a href="#!" class="btn js-close-popup">Понятно</a>
					</div>
                </div>
            </div>
		</div>
		<div id="map-success" class="popup map-popup">
			<div class="popup__wrap">
                <div class="popup__inner">
                	<div class="map-popup-title">
                		Спасибо! <br>
                		Твоя карта мечты создана <br>и отправлена на модерацию. <br>
                		Как только она будет одобрена — <br>сразу появится в твоём личном кабинете
                	</div>
                    <div class="btn-wrapper">
						<a href="#!" class="btn js-close-popup">Понятно</a>
					</div>
                </div>
            </div>
		</div>
	</div>

	<script src="libs/jquery-3.5.1.min.js"></script>
	<script src="libs/select2/select2.min.js"></script>
	<script src="libs/jquery.validate.min.js"></script>
	<script src="libs/scrollbar/jquery.scrollbar.min.js"></script>
	<script src="libs/jquery.inputmask.min.js"></script>
	<script src="libs/jquery.countdown.min.js"></script>
	<script src="libs/slick.min.js"></script>
	<script src="js/scripts.js"></script>
</body>

</html>